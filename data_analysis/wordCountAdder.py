import sys

if len(sys.argv) < 3:
    print(
        "Please provide a CSV file for analysis and specify the target file.\nUsage: python thisScript.py input.csv output.csv\nExiting...")
    sys.exit()

inputFile = str(sys.argv[1])
outputFile = str(sys.argv[2])

print("Stage 1: Generating set ...")
words = [[], []]  # structure is: [ [999, 998, ...], ["test", "test2", ...] ]
counter = 1
reader = open(inputFile, encoding='utf8').read().splitlines()
for line in reader:

    # this block is for logging purposes
    if counter % 1000 == 0:  # speed improvement, because otherwise console output limits speed
        print("Line " + str(int(counter / 1000)) + "k: " + line)

    counter += 1

    if line == "":  # this only happens with malformed line breaks
        continue

    lineBeforeComma, lineAfterComma = line.lower().split(",", 1)
    lineAfterComma = lineAfterComma.strip('.,:;!()[]\\/\#%&@"\'-_="''')

    if (lineAfterComma not in words[1]):
        words[0].append(lineBeforeComma)
        words[1].append(lineAfterComma)
    else:
        elementIndex = words[1].index(lineAfterComma)
        words[0][elementIndex] = str(int(words[0][elementIndex]) + int(lineBeforeComma))  # later sort needs consistency

print("Stage 2: Sorting list...")
wordsSorted = sorted(words, key=int, reverse=True)

print("Stage 3: Writing to file...")
with open(outputFile, 'w+', encoding="utf8") as f:
    for i in range(len(wordsSorted[0])):
        f.write(wordsSorted[1][i] + "," + wordsSorted[0][i] + "\n")

print("Finished.")
