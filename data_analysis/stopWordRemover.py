import sys
import operator
from stop_words import get_stop_words

if len(sys.argv) < 3:
    print(
        "Please provide a CSV file for analysis and specify the target file.\nUsage: python thisScript.py input.csv output.csv\nExiting...")
    sys.exit()

inputFile = str(sys.argv[1])
outputFile = str(sys.argv[2])
stop_words = get_stop_words('english')

print("Stage 1: Generating set ...")
words = [[], []]  # structure is: [ [999, 998, ...], ["test", "test2", ...] ]
counter = 1
inputFile = "sumAllWords.csv"
reader = open(inputFile, encoding='utf8').read().splitlines()
totalLines = sum(1 for line in reader)

print("Stage 2: Removing stop-words...")
for line in reader:
    lineIsSafe = True
    for x in stop_words:
        lineBeforeComma, lineAfterComma = line.lower().split(",", 1)
        if (len(lineAfterComma) < 3 or lineAfterComma.isnumeric() or any(
                [x == lineAfterComma]) or not lineAfterComma.islower()):
            lineIsSafe = False
    if (lineIsSafe):
        words[0].append(lineBeforeComma)
        words[1].append(lineAfterComma)

    # this block is for logging purposes
    if counter % 1000 == 0:  # speed improvement, because otherwise console output limits speed
        print("Line " + str(int(counter / 1000)) + "k of: " + str(int(totalLines / 1000)) + "k")
    counter += 1

print("Stage 3: Writing to file...")
with open(outputFile, 'w+', encoding="utf8") as f:
    data = f.read()
    f.seek(0)
    for i in range(len(words[0])):
        f.write(words[0][i] + "," + words[1][i] + "\n")

print("Finished.")
