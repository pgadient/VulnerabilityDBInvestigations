import csv, os

yearList = [1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011,
            2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019]
# monthList = ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12'] #NVD, RAPID7
monthList = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']  # Snyk
script_dir = os.path.dirname(__file__)
table = "Snyk"

for year in yearList:
    for month in monthList:
        words = []
        counter = 0
        rel_path = table + "/" + str(year) + "." + str(month) + ".csv"
        file = os.path.join(script_dir, rel_path)
        baseReader = open(file, encoding='utf8')
        reader = baseReader.read().splitlines()

        for line in reader:
            if line == "":  # this only happens with malformed line breaks
                continue
            csv_words = line.split(" ")
            for i in csv_words:
                i = i.strip('.,:;!()[]\\/\#%&@"\'-_="''')
                words.append(i)

        words_counted = []
        for i in words:
            words_counted.append((words.count(i), i))
            # this block is for logging purposes
            if counter % 1000 == 0:  # speed improvement, because otherwise console output limits speed
                print("Line " + str(int(counter / 1000)) + "k of: " + str(int(len(words) / 1000)) + "k")
            counter += 1

        fileName = baseReader.name
        # write to csv file
        with open(fileName, 'w+', newline='', encoding="utf8") as f:
            data = f.read()
            f.seek(0)
            words_counted = sorted(set(words_counted), reverse=True)
            writer = csv.writer(f)
            writer.writerows(words_counted)
    print("Results written for year: " + str(year))

print("Finished.")
